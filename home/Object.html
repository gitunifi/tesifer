<!DOCTYPE html>
<html lang="en">
<head>
    <title>three.js webgl - Spherical Panorama by Leonardo Galli & Tommaso Levato</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link href="http://marcoceppi.github.io/bootstrap-glyphicons/css/bootstrap.css" rel="stylesheet" type="text/css">
    <style>
        body {

        }
    </style>
</head>
<body>

<div id="info" align="center" style="background-color: #49311c; color: white;"><b>MICC - Media Integration and Communication Center</b></div>

<script type="text/javascript" src="jslibraries/three.min.js"></script>
<script type="text/javascript" src="jslibraries/DDSLoader.js"></script>
<script type="text/javascript" src="jslibraries/MTLLoader.js"></script>
<script type="text/javascript" src="jslibraries/OBJMTLLoader.js"></script>
<script type="text/javascript" src="jslibraries/jquery.min.js"></script>
<script type="text/javascript" src="js/ajax.js"></script>


<script>



    var container, stats;

    var camera, scene, renderer;

    var mouseX = 0, mouseY = 0;

    var windowHalfX = window.innerWidth / 2;
    var windowHalfY = window.innerHeight / 2;


    init();
    animate();


    function init() {
        var splitArray = window.location.search.split("=");
        var objectId = splitArray[1];
        var object = getContent("object", objectId);
        var obj = null;
        var mtl = null;
        if (object[0]) {
            obj = object[0]["Object"];
            mtl = object[0]["MTL"];
        }
        //loader.load('objects/' + object);

        container = document.createElement( 'div' );
        document.body.appendChild( container );

        camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 1000 );
        camera.position.z = 20;

        // scene

        scene = new THREE.Scene();

        var ambient = new THREE.AmbientLight( 0x444444 );
        scene.add( ambient );

        var directionalLight = new THREE.DirectionalLight( 0xffeedd );
        directionalLight.position.set( 0, 0, 1 ).normalize();
        scene.add( directionalLight );

        // model

        var onProgress = function ( xhr ) {
            if ( xhr.lengthComputable ) {
                var percentComplete = xhr.loaded / xhr.total * 100;
                console.log( Math.round(percentComplete, 2) + '% downloaded' );
            }
        };

        var onError = function ( xhr ) {
        };


        THREE.Loader.Handlers.add( /\.dds$/i, new THREE.DDSLoader() );

        var loader = new THREE.OBJMTLLoader();
        loader.load( 'objects/' + obj, 'objects/' + mtl , function ( object ) {

            object.position.y = -5;
            scene.add( object );

        }, onProgress, onError );

        //

        renderer = new THREE.WebGLRenderer();
        renderer.setClearColor( 0x49311c, 1);
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        container.appendChild( renderer.domElement );

        document.addEventListener( 'mousemove', onDocumentMouseMove, false );
        document.addEventListener('mousewheel', onDocumentMouseWheel, false);

        //

        window.addEventListener( 'resize', onWindowResize, false );

    }

    function onWindowResize() {

        windowHalfX = window.innerWidth / 2;
        windowHalfY = window.innerHeight / 2;

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );

    }

    function onDocumentMouseMove( event ) {

        mouseX = ( event.clientX - windowHalfX ) / 4;
        mouseY = ( event.clientY - windowHalfY ) / 4;

    }

    function onDocumentMouseWheel( event ) {
        event.preventDefault();
    }

    //

    function animate() {

        requestAnimationFrame( animate );
        render();

    }

    function render() {

        camera.position.x = ( -mouseX - camera.position.x ) * 0.5;
        camera.position.y = ( + mouseY - camera.position.y ) * 0.5;

        camera.lookAt( scene.position );

        renderer.render( scene, camera );

    }

    //arrow helper?
    /*var camera, scene, renderer, mesh;
    var objects = [];
    var loader = new THREE.OBJMTLLoader();
    var fov = 70,
        plane,
        isUserInteracting = false,
        onMouseDownMouseX = 0, onMouseDownMouseY = 0,
        lon = 0, onMouseDownLon = 0,
        lat = 0, onMouseDownLat = 0,
        phi = 0, theta = 0,
        latLimit = -30,
        projector,
        minZoom = 100, maxZoom = 20,
        interactiveObject,
        onMouseDownObjectXRotation,
        onMouseDownObjectYRotation,
        onMouseDownObjectZRotation,
        isRightClick = false;
    init();
    animate();
    function init() {
        loader.addEventListener('load', function (event) {
            var object = event.content;
            object.position.x = 20;
            object.position.y = 0;
            object.position.z = 0;
            object.rotation.y = -Math.PI / 2;
            var geometry = object.children[0].geometry;
            THREE.GeometryUtils.center(geometry);
            scene.add(object);
            objects.push(object);
        }, false);
        camera = new THREE.PerspectiveCamera(fov, window.innerWidth / window.innerHeight, 1, 1100);
        camera.target = new THREE.Vector3(0, 0, 0);
        scene = new THREE.Scene();

        var geometry = new THREE.PlaneGeometry(200, 200);
        geometry.applyMatrix(new THREE.Matrix4().makeRotationX(-Math.PI / 2));
        var material = new THREE.MeshBasicMaterial({color: 0xe0e0e0});
        plane = new THREE.Mesh(geometry, material);
        plane.position.set(17, 0, 0);
        plane.lookAt(new THREE.Vector3(0, 0, 0));
        scene.add(plane);

        var splitArray = window.location.search.split("=");
        var objectId = splitArray[1];
        var object = getContent("object", objectId);
        loader.load('objects/' + object);

        renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);
        //shadow
        var light = new THREE.DirectionalLight(0xffffff);
        light.position.set(0, 0, 0);
        light.target.position.set(10, 0, 0);
        scene.add(light);

        var light1 = new THREE.DirectionalLight(0xffffff);
        light1.position.set(2, 0, 0);
        light1.target.position.set(10, 0, 0);
        scene.add(light1);

        var light2 = new THREE.DirectionalLight(0xffffff);
        light2.position.set(-2, 0, 0);
        light2.target.position.set(10, 0, 0);
        scene.add(light2);
        scene.add(light);
        //renderer.shadowMapEnabled = true;
        light.castShadow = true;
        light.shadowDarkness = 1;
        renderer.shadowMapSoft = true;
        plane.receiveShadow = true;
        //

        document.addEventListener('mousedown', onDocumentMouseDown, false);
        document.addEventListener('mousemove', onDocumentMouseMove, false);
        document.addEventListener('mouseup', onDocumentMouseUp, false);
        document.addEventListener('mousewheel', onDocumentMouseWheel, false);
        document.addEventListener('DOMMouseScroll', onDocumentMouseWheel, false);
        window.addEventListener('resize', onWindowResize, false);


    }*/


</script>